# ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ PostgreSQL –∑–∞–≤–µ—Ä—à–µ–Ω–∞

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### üì¶ –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **docker-compose.yml**
   - ‚ú® –î–æ–±–∞–≤–ª–µ–Ω —Å–µ—Ä–≤–∏—Å PostgreSQL 16 (`db`)
   - ‚ú® –î–æ–±–∞–≤–ª–µ–Ω volume `postgres_data` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
   - ‚ùå –£–¥–∞–ª–µ–Ω volume `./data` (SQLite –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
   - ‚úÖ Backend –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∑–¥–æ—Ä–æ–≤—å—è –ë–î (healthcheck)

2. **backend/requirements.txt**
   - ‚ú® –î–æ–±–∞–≤–ª–µ–Ω `psycopg2-binary==2.9.9` (PostgreSQL –¥—Ä–∞–π–≤–µ—Ä)

3. **backend/app/config.py**
   - ‚úèÔ∏è –ò–∑–º–µ–Ω–µ–Ω DATABASE_URL –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞ PostgreSQL
   - ‚ùå –£–¥–∞–ª–µ–Ω –∫–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è SQLite

4. **backend/app/database.py**
   - ‚ùå –£–¥–∞–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `check_same_thread` (—Å–ø–µ—Ü–∏—Ñ–∏—á–µ–Ω –¥–ª—è SQLite)
   - ‚ú® –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `echo=False, pool_pre_ping=True`

5. **.env** ‚ú® –ù–û–í–´–ô –§–ê–ô–õ
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL
   - –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

6. **.env.example**
   - ‚úèÔ∏è –û–±–Ω–æ–≤–ª–µ–Ω —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –¥–ª—è PostgreSQL
   - ‚ú® –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è Docker –∏ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

7. **README.md**
   - ‚úèÔ∏è –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
   - ‚ú® –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ PostgreSQL
   - ‚úèÔ∏è –ò–∑–º–µ–Ω–µ–Ω—ã –∫–æ–º–∞–Ω–¥—ã –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö

8. **backend/migrate_sqlite_to_postgres.py** ‚ú® –ù–û–í–´–ô –§–ê–ô–õ
   - –°–∫—Ä–∏–ø—Ç –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ SQLite –≤ PostgreSQL
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–Ω–æ—Å –Ω–∞–±–ª—é–¥–µ–Ω–∏–π –∏ —Ä–µ—à–µ–Ω–∏–π –æ—Ä–±–∏—Ç

9. **MIGRATION.md** ‚ú® –ù–û–í–´–ô –§–ê–ô–õ
   - –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏
   - Troubleshooting
   - –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

### –î–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö SQLite)

```bash
# –ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ Docker Compose
docker compose up --build
```

–ì–æ—Ç–æ–≤–æ! –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞:
- Frontend: http://localhost:5173
- Backend API: http://localhost:8000
- PostgreSQL: localhost:5432

### –î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–µ—Å—Ç—å data/app.db)

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ PostgreSQL
docker compose up -d db

# 2. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–ø—É—Å–∫–∞ –ë–î (10 —Å–µ–∫—É–Ω–¥)
timeout /t 10

# 3. –ú–∏–≥—Ä–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ
cd backend
pip install -r requirements.txt
python migrate_sqlite_to_postgres.py

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
cd ..
docker compose up --build
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î PostgreSQL

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** `cometlab`  
**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** `cometuser`  
**–ü–∞—Ä–æ–ª—å:** `cometpass123`

**–¢–∞–±–ª–∏—Ü—ã:**
- `observation` - –Ω–∞–±–ª—é–¥–µ–Ω–∏—è –∫–æ–º–µ—Ç
- `orbitsolution` - —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ –æ—Ä–±–∏—Ç—ã

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

1. –û—Ç–∫—Ä–æ–π—Ç–µ Swagger UI: http://localhost:8000/docs
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `/observations` POST
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ø–∏—Å–æ–∫: `/observations` GET
4. –î–æ–±–∞–≤—å—Ç–µ 5+ –Ω–∞–±–ª—é–¥–µ–Ω–∏–π –∏ –≤—ã–∑–æ–≤–∏—Ç–µ `/compute` POST

## üõ†Ô∏è –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL

```bash
# –ß–µ—Ä–µ–∑ Docker
docker exec -it comet-postgres psql -U cometuser -d cometlab

# –õ–æ–∫–∞–ª—å–Ω–æ (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω psql)
psql -U cometuser -d cometlab -h localhost
```

### SQL –∫–æ–º–∞–Ω–¥—ã

```sql
-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–∞–±–ª–∏—Ü—ã
\dt

-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
SELECT COUNT(*) FROM observation;
SELECT COUNT(*) FROM orbitsolution;

-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–∞–Ω–Ω—ã–µ
SELECT id, ra_hours, dec_degrees, observation_time FROM observation LIMIT 5;

-- –û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
TRUNCATE observation, orbitsolution RESTART IDENTITY CASCADE;

-- –í—ã—Ö–æ–¥
\q
```

### Docker –∫–æ–º–∞–Ω–¥—ã

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker compose down

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å volumes (–£–î–ê–õ–ò–¢ –î–ê–ù–ù–´–ï!)
docker compose down -v

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
docker compose logs -f

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ —Ç–æ–ª—å–∫–æ –ë–î
docker compose logs -f db

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
docker compose restart backend
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

**–î–æ –º–∏–≥—Ä–∞—Ü–∏–∏ (SQLite):**
```
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îî‚îÄ‚îÄ app.db          # –§–∞–π–ª –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îî‚îÄ‚îÄ uploads/            # –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
    ‚îî‚îÄ‚îÄ *.jpg, *.png
```

**–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (PostgreSQL):**
```
‚îú‚îÄ‚îÄ postgres_data/      # Docker volume (–≤–Ω—É—Ç—Ä–∏ Docker)
‚îî‚îÄ‚îÄ uploads/            # –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
    ‚îî‚îÄ‚îÄ *.jpg, *.png
```

**‚ö†Ô∏è –í–∞–∂–Ω–æ:** –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –≤ `uploads/` –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ –º–µ—Å—Ç–µ –∏ –Ω–µ —Ç—Ä–µ–±—É—é—Ç –º–∏–≥—Ä–∞—Ü–∏–∏!

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ PostgreSQL

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –±—ã—Å—Ç—Ä–µ–µ –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
2. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
3. **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å** - ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è
4. **Production-ready** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
5. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏** - JSON, –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫, –≥–µ–æ–¥–∞–Ω–Ω—ã–µ

## üîÑ –û—Ç–∫–∞—Ç –Ω–∞ SQLite (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)

–ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ SQLite:

```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã
git checkout HEAD -- docker-compose.yml backend/requirements.txt backend/app/config.py backend/app/database.py

# –û–±–Ω–æ–≤–∏—Ç–µ .env
echo "DATABASE_URL=sqlite:///data/app.db" > .env

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
docker compose down
docker compose up --build
```

## üìû –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–º–æ—â–∏

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `MIGRATION.md` - —Ä–∞–∑–¥–µ–ª Troubleshooting
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏: `docker compose logs`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å: `docker compose ps`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env —Ñ–∞–π–ª –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å

## üéâ –ì–æ—Ç–æ–≤–æ!

–í–∞—à –ø—Ä–æ–µ–∫—Ç —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PostgreSQL –∏ –≥–æ—Ç–æ–≤ –∫ production-–¥–µ–ø–ª–æ—é!

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–π
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞—Å—á–µ—Ç –æ—Ä–±–∏—Ç (–º–∏–Ω–∏–º—É–º 5 –Ω–∞–±–ª—é–¥–µ–Ω–∏–π)
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î —á–µ—Ä–µ–∑ pgAdmin –∏–ª–∏ DBeaver
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –±—ç–∫–∞–ø—ã PostgreSQL –¥–ª—è production

---

**–£—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ PostgreSQL:**
- Database: `cometlab`
- User: `cometuser`
- Password: `cometpass123`
- Host: `localhost` (–∏–ª–∏ `db` –≤–Ω—É—Ç—Ä–∏ Docker)
- Port: `5432`
